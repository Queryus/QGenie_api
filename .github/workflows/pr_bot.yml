# .github/workflows/pr_bot.yml
name: Pull Request Bot

on:
  # Pull Request ê´€ë ¨ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ
  pull_request:
    types: [opened, closed, reopened, synchronize]
  issue_comment:
    types: [created]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      # -------------------------
      #   ìƒì„±/ë™ê¸°í™” ì•Œë¦¼
      # -------------------------
      - name: Send PR Created Notification
        if: github.event_name == 'pull_request' && (github.event.action == 'opened' || github.event.action == 'synchronize')
        run: |
          curl -X POST -H "Content-Type: application/json" \
          -d '{
            "username": "GitHub PR ë´‡",
            "embeds": [{
              "title": "Pull Request #${{ github.event.pull_request.number }}: ${{ github.event.pull_request.title }}",
              "description": "ğŸ”· **${{ github.actor }}**ë‹˜ì´ Pull Requestë¥¼ ìƒì„±í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤. ğŸ”·",
              "url": "${{ github.event.pull_request.html_url }}",
              "color": 2243312
            }]
          }' \
          ${{ secrets.DISCORD_WEBHOOK_URL }}

      # -------------------------
      #   ëŒ“ê¸€ ì•Œë¦¼
      # -------------------------
      - name: Send PR Comment Notification
        if: github.event_name == 'issue_comment' && github.event.issue.pull_request
        run: |
          COMMENT_BODY=$(echo "${{ github.event.comment.body }}" | sed 's/"/\\"/g' | sed ':a;N;$!ba;s/\n/\\n/g')
          curl -X POST -H "Content-Type: application/json" \
          -d '{
            "username": "GitHub ëŒ“ê¸€ ë´‡",
            "embeds": [{
              "title": "New Comment on PR #${{ github.event.issue.number }}",
              "description": "ğŸŸ  **${{ github.actor }}**ë‹˜ì˜ ìƒˆ ëŒ“ê¸€: \n${COMMENT_BODY} ğŸŸ ",
              "url": "${{ github.event.comment.html_url }}",
              "color": 15105570
            }]
          }' \
          ${{ secrets.DISCORD_WEBHOOK_URL }}

      # -------------------------
      #   ë¨¸ì§€(Merge) ì•Œë¦¼
      # -------------------------
      - name: Send PR Merged Notification
        if: github.event.action == 'closed' && github.event.pull_request.merged == true
        run: |
          curl -X POST -H "Content-Type: application/json" \
          -d '{
            "username": "GitHub Merge ë´‡",
            "embeds": [{
              "title": "Pull Request #${{ github.event.pull_request.number }} Merged!",
              "description": "âœ… **${{ github.actor }}**ë‹˜ì´ **${{ github.event.pull_request.title }}** PRì„ ë¨¸ì§€í–ˆìŠµë‹ˆë‹¤. âœ…",
              "url": "${{ github.event.pull_request.html_url }}",
              "color": 5167473
            }]
          }' \
          ${{ secrets.DISCORD_WEBHOOK_URL }}

      # -------------------------
      #   ë‹«í˜(Close) ì•Œë¦¼
      # -------------------------
      - name: Send PR Closed Notification
        if: github.event.action == 'closed' && github.event.pull_request.merged == false
        run: |
          curl -X POST -H "Content-Type: application/json" \
          -d '{
            "username": "GitHub PR ë´‡",
            "embeds": [{
              "title": "Pull Request #${{ github.event.pull_request.number }} Closed",
              "description": "âŒ **${{ github.actor }}**ë‹˜ì´ **${{ github.event.pull_request.title }}** PRì„ ë‹«ì•˜ìŠµë‹ˆë‹¤. âŒ",
              "url": "${{ github.event.pull_request.html_url }}",
              "color": 15219495
            }]
          }' \
          ${{ secrets.DISCORD_WEBHOOK_URL }}
